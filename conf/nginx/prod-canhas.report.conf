server {
    listen 80;
    listen [::]:80;
    server_name .canhas.report;
    include /srv/www/canhas.report/conf/nginx/common-canhas.report.conf;
    return 301 https://$host$request_uri;
}

server {
    listen 80;
    listen [::]:80;
    server_name www.canhas.report;
    include /srv/www/canhas.report/conf/nginx/common-canhas.report.conf;
    return 301 https://canhas.report$request_uri;
}

server {
    listen 80;
    listen [::]:80;
    server_name .icanhas.report;
    include /srv/www/canhas.report/conf/nginx/common-canhas.report.conf;
    return 301 https://icanhas.report$request_uri;
}

server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name canhas.report;
    root /srv/www/canhas.report/site/www;
    set $base canhas.report;
    include /srv/www/canhas.report/conf/nginx/prod-https.conf;
    include /srv/www/canhas.report/conf/nginx/common-canhas.report.conf;
    location ~* \.php$ {
        include /srv/www/canhas.report/conf/nginx/prod-php.conf;
    }
}

server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name "~^(?<who>[a-z]+)\.canhas\.report$";
    root /srv/www/canhas.report/site/reports;
    index reports.php index.php;
    set $base canhas.report;
    include /srv/www/canhas.report/conf/nginx/prod-https.conf;
    include /srv/www/canhas.report/conf/nginx/common-canhas.report.conf;
    location ~* \.php$ {
        include /srv/www/canhas.report/conf/nginx/prod-php.conf;
    }
    location = /.well-known/security.txt {
        return 301 $scheme://$base/.well-known/security.txt;
    }
}

server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name icanhas.report;
    root /srv/www/canhas.report/site/hivemind;
    set $base canhas.report;
    include /srv/www/canhas.report/conf/nginx/prod-https.conf;
    include /srv/www/canhas.report/conf/nginx/common-canhas.report.conf;
    location ~* \.php$ {
        include /srv/www/canhas.report/conf/nginx/prod-php.conf;
    }
}

server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name www.canhas.report;
    include /srv/www/canhas.report/conf/nginx/prod-https.conf;
    include /srv/www/canhas.report/conf/nginx/common-canhas.report.conf;
    return 301 $scheme://canhas.report$request_uri;
}

server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name www.icanhas.report;
    include /srv/www/canhas.report/conf/nginx/prod-https.conf;
    include /srv/www/canhas.report/conf/nginx/common-canhas.report.conf;
    return 301 $scheme://icanhas.report$request_uri;
}
